<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decrypt</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='stylee.css') }}">

</head>
<body>
    <header>
        <div class="left"> Encryptor / Decryptor </div>
        <div class="right">by vineeth </div>
    </header><br>
    <div class="container">
        <div class="box1">
            <img src="{{ url_for('static', filename='file3.jpeg') }}" style="max-width: 80px; max-height: 80px;">
            <div class="h1 white center-text">TEXT ENCRYPTER </div>
            <p class="center-text custom-text red"> Free and Secure Text Encrypter.<br>
                Private Encryption and Decryption in your Browser
            </p>
            <p class="custom-text white"> Text Encrypter allows to securely encrypt and decrypt any kind of text data for protected storage. It can be used for sensitive data encryption for example passwords or seeds. It uses secure AES CBC algorithm with 256 bits long key.
                Data encrypted with Text Encrypter can be later decrypted using any AES-256 CBC implementation software or script.</p>
            <h1 class="center-text h1 white">
                How IT WORKS
            </h1>
            <p class=" custom-text white">
                1. Enter or upload the encrypted text.<br>
                2. Enter the encryption key used during encryption (same key as before).<br>
                3. If typing the encrypted text, also provide the IV (Initialization Vector).<br>
                4. If uploading a file, the IV will be read automatically.<br>
                5. Click Decrypt to reveal the original text.<br>
            </p>
            <div class="custom-text white"><br>
                Encryption algorithm setup <br>
                # Algorithm: AES (Advanced Encryption Standard)<br>
                # Mode: CBC (Cipher Block Chaining)<br>
                # Key Length: Variable input length (user-defined), internally hashed to 256-bit using SHA-256<br>
                # IV (Initialization Vector): 16 bytes, randomly generated during encryption<br>
                # Padding Scheme: PKCS#7<br>
                # Encoding: Base64 for ciphertext and IV for safe display and transfer<br>
            </div>

        </div>
        <div class="box2">
            <header>
            <div class="h1 center-text">
                        DECRYPTION PANEL<br>
                    </div>
            </header>
            <div class="subbox">
                <div class="subsec">
                        <!-- Toggle Buttons -->
                    <div class="input-switch ">
                        <button class="type-button" id="btnText">Type Text</button>
                        <button class="file-button" id="btnFile">Read a File</button>
                    </div>

                    <!-- Textarea Input Section -->
                    <div id="text-input-section">
                        <label class="custom-text black" for="plaintext">Enter Plaintext</label>
                        <textarea id="plaintext" placeholder="Enter your text..."></textarea>
                    </div>

                    <!-- File Input Section -->
                    <div id="file-input-section" style="display: none;">
                        <label class="h3 white" for="fileInput">Upload a Text File</label>
                        <input type="file" id="fileInput" accept=".txt">
                    </div>

                    <!-- IV Key -->
                    <div id="iv-input-section">
                        <label class="custom-text black" for="iv">Initialization Vector (base 64 encoded)</label>
                        <textarea id="iv" placeholder="provide IV"></textarea>
                    </div>

                    <!-- Encryption Key -->
                    <label class="custom-text black" for="key">Encryption key</label>
                    <textarea id="key" placeholder="provide encryption key"></textarea>

                    <!-- Buttons -->
                    <div class="button-section"><br>
                        <button class="en-button" onclick="decrypt()">Decrypt</button>
                    </div>
                </div>
                <div class="subsec">
                    <label class="custom-text black" for="resultText"> Output Generated </label>
                    <textarea id="resultText" readonly></textarea> <br>
                    <button class="en-button" id="save-btn">Save File</button>
                        
                </div>
            </div>
        </div>
      <script>
        // Toggle between text input and file upload
        document.getElementById('btnText').addEventListener('click', () => {
            document.getElementById('text-input-section').style.display = 'block';
            document.getElementById('file-input-section').style.display = 'none';
            document.getElementById('iv-input-section').style.display = 'block';

        });

        document.getElementById('btnFile').addEventListener('click', () => {
            document.getElementById('text-input-section').style.display = 'none';
            document.getElementById('file-input-section').style.display = 'block';
            document.getElementById('iv-input-section').style.display = 'none';

        });

        // Read file content and fill in textarea
        document.getElementById('fileInput').addEventListener('change', function () {
    const file = this.files[0];
    if (file && file.type === "text/plain") {
        const reader = new FileReader();
        reader.onload = function (e) {
            const content = e.target.result;

            // Extract the values using RegEx
            const cipherMatch = content.match(/Encrypted Text:\s*([^\n\r]+)/);
            const ivMatch = content.match(/IV:\s*([^\n\r]+)/);

            if (cipherMatch && ivMatch) {
                document.getElementById('plaintext').value = cipherMatch[1].trim();
                document.getElementById('iv').value = ivMatch[1].trim();
            } else {
                alert("Invalid file format. Make sure it contains 'Encrypted Text:' and 'IV:' lines.");
            }
        };
        reader.readAsText(file);
    } else {
        alert("Please upload a valid .txt file.");
    }
});

// Save result to file
document.getElementById("save-btn").addEventListener("click", function () {
    const text = document.getElementById("resultText").value;
    const blob = new Blob([text], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "decrypted_output.txt";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});
    async function decrypt() {
        let ciphertext = document.getElementById('plaintext').value;
        let key = document.getElementById('key').value;
        let iv = document.getElementById('iv').value;

        let res = await fetch("/decrypt", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ input: ciphertext, key: key, iv: iv })
        });

        let data = await res.json();
        console.log("Decrypted message", data);
        

        if (data.plaintext) {
            document.getElementById('resultText').value = data.plaintext;
        } else {
            document.getElementById('resultText').value = "Error: " + JSON.stringify(data);
        }
    }

    </script>





</body>
</html>